/*! jquery.a11yTree */
!function(a,b,c,d){function e(b,c){this.element=b,this.options=a.extend({},defaults,c),this._defaults=defaults,this.init()}var f="a11yTree",g="plugin_",h="ul",i="li",j="id",k="at-n",l="at-identity",m="-label",n="tabindex",o="keydown",p="click",q="role",r="aria-level",s="tree",t="treeitem",u="group",v="aria-selected",w="aria-expanded",x="aria-activedescendant",y="aria-labelledby",z='li[aria-expanded="true"]',A='[aria-selected="true"]',B="at-has-children",C="."+B,D="at-no-children",E="at-toggle",F="."+E,G=40,H=38,I=39,J=37,K=13,L=35,M=36;defaults={treeLabelId:d,treeItemLabelSelector:d,insertToggle:!0,customToggle:{html:d},onExpand:function(){},onCollapse:function(){}},e.prototype={init:function(){var b=a(this.element);this.identifyChildren(b,s,1),this.addTreeLabels(b),this.addToggle(b),this.addMouseNav(b),this.addKeyBoardNav(b)},addTreeLabels:function(b){var c=this,d=c.options.treeLabelId;d&&a("#"+d).length>0&&b.attr(y,d);var e=this.options.treeItemLabelSelector;if(e){var f=b.find(C);f.each(function(){var b=a(this),c=b.children(e).attr(j);c&&b.children(h).attr(y,c)})}},addToggle:function(b){var c=this;if(c.options.insertToggle!==!1){var d="";c.options.customToggle.html&&(d=c.options.customToggle.html),b.find(C).prepend('<div class="'+E+'" aria-hidden="true">'+d+"</div>"),b.find(F).on(p,function(){var b=a(this).parent(i);c.toggleExpandCollapse(b)})}},addMouseNav:function(b){var c=this;b.find(i).click(function(d){d.stopPropagation(),c.focusOn(a(this),b)})},addKeyBoardNav:function(a){this.focusOn(this.findFirstListItem(a),a),this.addTreeToTabOrder(a),this.handleKeys(a)},isKey:function(a,b){return a.which===b},handleKeys:function(a){var b=this;a.on(o,function(c){var d=a.find(A);b.isKey(c,G)?(c.preventDefault(),b.handleDownArrowKey(d,a)):b.isKey(c,H)?(c.preventDefault(),b.handleUpArrowKey(d,a)):b.isKey(c,I)?(c.preventDefault(),b.handleRightArrowKey(d,a)):b.isKey(c,J)?(c.preventDefault(),b.handleLeftArrowKey(d,a)):b.isKey(c,K)?b.handleEnterKey(d,a):b.isKey(c,L)?(c.preventDefault(),b.handleEndKey(d,a)):b.isKey(c,M)&&(c.preventDefault(),b.handleHomeKey(d,a))})},addTreeToTabOrder:function(a){a.attr(n,"0")},handleLeftArrowKey:function(a,b){this.isExpanded(a)?this.collapse(a):this.focusOn(this.findParent(a),b)},handleRightArrowKey:function(a,b){this.isCollapsed(a)?this.expand(a):this.isExpanded(a)&&this.focusOn(this.findFirstListItemInSubList(a),b)},handleUpArrowKey:function(a,b){var c=a.prev();this.isExpanded(c)?this.focusOnLastVisibleElementInTree(c.children(h),b):0===a.prev().length?this.focusOn(this.findParent(a),b):this.focusOn(a.prev(),b)},handleDownArrowKey:function(a,b){this.hasChildren(a)&&this.isExpanded(a)?this.focusOn(this.findFirstListItemInSubList(a),b):this.focusOnNextAvailableSiblingInTree(a,b)},handleEnterKey:function(a){this.toggleExpandCollapse(a)},handleEndKey:function(a,b){this.focusOnLastVisibleElementInTree(b)},handleHomeKey:function(a,b){this.focusOn(this.findFirstListItem(b),b)},hasChildren:function(a){return a.hasClass(B)},focusOn:function(a,b){1===a.length&&(b.find(i).attr(v,"false"),a.attr(v,"true"),b.attr(x,a.attr(j)))},focusOnNextAvailableSiblingInTree:function(a,b){0!==a.length&&(a.next().length>0?this.focusOn(a.next(),b):this.focusOnNextAvailableSiblingInTree(this.findParent(a),b))},focusOnLastVisibleElementInTree:function(a,b){var c=a.find(i).last(),d=c.parent(h);if(!this.isParentTree(d)){var e=c.closest(z);d=0===e.length?a:e.children(h)}this.focusOn(this.findLastListItem(d),b||a)},expand:function(a){this.options.onExpand&&this.options.onExpand(a),a.attr(w,"true")},collapse:function(a){this.options.onCollapse&&this.options.onCollapse(a),a.attr(w,"false")},isExpanded:function(a){return"true"===a.attr(w)},isCollapsed:function(a){return"false"===a.attr(w)},toggleExpandCollapse:function(a){this.isCollapsed(a)?this.expand(a):this.collapse(a)},isParentTree:function(a){return a.attr(q)===s},findParent:function(a){return a.parent(h).parent(i)},findLastListItem:function(a){return a.find(" > li:last-child")},findFirstListItem:function(a){return a.find(" > li:first-child")},findFirstListItemInSubList:function(a){return a.children(h).find(" > li:first-child")},identifyListItemWithChildren:function(a){this.collapse(a),a.addClass(B)},identifySubChildren:function(a,b,c){var d=a.children(h);d.length>0?(this.identifyListItemWithChildren(a),this.identifyChildren(d,u,c+1,b)):a.addClass(D)},identifyChildren:function(b,c,d){var e=this;b.attr(q,c);var f=b.children(i);f.attr(q,t).attr(r,d),f.each(function(){e.addIdToListItem(a(this),b,d),e.identifySubChildren(a(this),b,d)})},addIdToListItem:function(a,b){var c=this.generateListItemId(a,b);this.addIdAsDataOrId(a,c)},addIdAsDataOrId:function(a,b){var c=a.attr(j),d=b;c?(d=c,a.data(l,b)):a.attr(j,b),this.addIdToNodeLabel(a,d)},addIdToNodeLabel:function(a,b){var c=this.options.treeItemLabelSelector;if(c){var d=a.children(c),e=d.attr(j);e||d.attr(j,b+m)}},generateListItemId:function(a,b){var c;return c=0===b.parent(i).length?k:a.data(l)||b.parent(i).attr(j),c+"-"+b.children(i).index(a)}},a.fn[f]=function(b){return this.each(function(){a.data(this,g+f)||a.data(this,g+f,new e(this,b))})}}(jQuery,window,document);